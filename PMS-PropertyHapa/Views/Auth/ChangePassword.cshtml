@model PMS_PropertyHapa.Models.DTO.ChangePasswordRequestDto

@{
    ViewData["Title"] = "Change Password";
    Layout = "~/Views/Shared/_IdentityLayout.cshtml";
}


@section Scripts {
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(function () {
            $('.changePasswordForm').on('submit', function (e) {
                e.preventDefault();

                var formData = new FormData();
                formData.append('UserId', localStorage.getItem('userId'));
                formData.append('currentPassword', $('#currentPassword').val());
                formData.append('newPassword', $('#newPassword').val());
                formData.append('newRepeatPassword', $('#confirmPassword').val());

                if ($('#newPassword').val() !== $('#confirmPassword').val()) {
                    var Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, progressBar: true, timer: 3000 });
                    Toast.fire({ icon: 'error', title: 'New password and confirmation password do not match.' });
                    return;
                }

                $.ajax({
                    url: '/Auth/ChangePassword',
                    type: 'POST',
                    processData: false,  
                    contentType: false,  
                    data: formData,
                    success: function (response) {
                        var Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, progressBar: true, timer: 3000 });
                        Toast.fire({ icon: 'success', title: 'Password changed successfully.' });
                    },
                    error: function (xhr, status, error) {
                        var Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, progressBar: true, timer: 3000 });
                        Toast.fire({ icon: 'error', title: 'An error occurred' });
                    }
                });
            });
        });
    </script>

}


<form class="theme-form needs-validation changePasswordForm" novalidate="" method="post">

    <h2>Change Password</h2>
    <div class="form-group mb-3">
        <label for="currentPassword">Current Password:</label>
        <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
    </div>
    <div class="form-group mb-3">
        <label for="newPassword">New Password:</label>
        <input type="password" class="form-control" id="newPassword" name="newPassword" required>
    </div>
    <div class="form-group mb-3">
        <label for="confirmPassword">Confirm New Password:</label>
        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
    </div>
    <div class="form-group">
        <button class="btn btn-primary btn-block" type="submit">Change Password</button>
    </div>
</form>
