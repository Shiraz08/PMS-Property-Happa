@{
    ViewData["Title"] = "Tenant Portal";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .landing-home {
        position: relative;
        height: 60vh; y
        margin-top: 90px;
        overflow: hidden; 
    }

    .marquee-container {
        position: absolute; 
        width: 100%;
        background-color: white; 
        z-index: 10; 
    }

    marquee {
        width: 100%;
        color: black; 
        font-size: 20px;
        padding: 10px 0; 
        cursor: pointer; 
    }

    .img-fluid {
        width: 100%;
        height: 100%; 
        object-fit: cover; 
        position: relative; 
    }
</style>
<section class="landing-home" id="home" style="height: 50vh;margin-bottom: 0px !important;margin-top: 90px !important;">
    <div class="marquee-container">
        <marquee behavior="scroll" direction="left" style="width: 100%; color: black; font-size: 20px;" title="Click for more details"></marquee>
    </div>
    <img class="img-fluid bg-img-cover" src="~/Dashboard/assets/images/building.jpg" alt="">
    <div class="custom-container">
        <div class="row">
            <div class="col-12">
                <div class="landing-home-contain">
                    <div class="d-flex h-50 w-100 ">
                        <div class="w-25 h-50 leftSectionBannar"></div>
                        <div class="w-75 d-flex h-50 rightSectionBannar">
                            <div class="">
                                <div class="welcomBanner textWrapp">Welcome One</div>
                                <div class="cradittext mt-2 textWrapp">Cradit Available</div>
                                <div class="moneyText mt-2 textWrapp">$ 1,000.00</div>
                                <div class="mt-2 fw-light textWrapp">
                                    You next rent of
                                    <span class="fw-bold ">$ 2,100.00</span>
                                    is due on
                                    <span class="fw-bold ">4/8/2023</span>
                                </div>
                                <div class="mt-2 fw-light textAlignment textWrapp">
                                    16182 RIO BAIL / HOUSE 2
                                </div>
                            </div>
                            <div class="d-flex align-items-end gap-2 InfobutonWrapper">
                                <button class="btn btn-light Cutombuttons">Setup auto-pay</button>
                                <button class="btn btn-primary Cutombuttons">Make a Payment</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

</section>


<div class="textdiv w-100 h-100 d-flex justify-content-center align-items-center ">
    <div class="ReadMoreWrappar d-flex">
        <div class="d-flex justify-content-between align-items-center p-3 w-100">
            <img src="~/Dashboard/assets/images/message-icon.svg" style="width: 30px; height: 30px;" />
            <div class="w-50">
                <div class="d-flex justify-content-between align-items-center" style="border-bottom: 1px solid #9e9ed8;">
                    <span class="fw-bold ">One Love</span>
                    <span class="fw-bold">21-11-2022</span>
                </div>
                <div class="m-1">
                    <span>Let's get togather and feel alright</span>
                </div>
            </div>
            <button class="btn btn-dark">
                Read more
            </button>
        </div>
    </div>
</div>




<!-- landing home end-->
<!-- demo section start-->
<section class="demo-section section-py-space" id="dashboard">

    <div class="custom-container">
        <div class="row demo-block">
            <div lass="col-lg-3 col-md-6 wow pulse"></div>
            <div class="col-lg-3 col-md-6 wow pulse">
                <div class="demo-box">
                    <div class="img-wrraper bannarSetup">
                        <img class="img-fluid" src="~/Dashboard/assets/images/autoPay.png" alt="" style="width: 70px">
                        <h5 class="mt-1 ">AutoPay is active</h5>
                        <p>You have 1 active auto-pay for this lease</p>
                        <button class="btn btn-dark">Setup Auto-Pay</button>
                    </div>

                </div>
            </div>
            <div class="col-lg-3 col-md-6 wow pulse">
                <div class="demo-box">
                    <div class="img-wrraper bannarSetup">
                        <img class="img-fluid" src="~/Dashboard/assets/images/insurence.png" alt="" style="width: 60px">
                        <h5 class="mt-1 ">You Are Insured</h5>
                        <p>Insurence R Us</p>
                        <button class="btn btn-dark">Get Insurence</button>
                    </div>

                </div>
            </div>
            <div class="col-lg-3 col-md-6 wow pulse">
                <div class="demo-box">
                    <div class="img-wrraper bannarSetup">
                        <img class="img-fluid" src="~/Dashboard/assets/images/request.png" alt="" style="width: 70px">
                        <h5 class="mt-1 ">Requests</h5>
                        <p>You have 50 active requests for this lease</p>
                        <button class="btn btn-dark">New Request</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</section>

<div class="modal fade" id="announcementModal" tabindex="-1" aria-labelledby="announcementModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="announcementModalLabel">Announcement Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Subject</th>
                            <th>Message</th>
                            <th>No of Announcements</th>
                            <th>Remove Feed Date</th>
                            <th>Added At</th>
                            <th>Added By</th>
                        </tr>
                    </thead>
                    <tbody id="announcementDetailsTableBody">
                        <!-- Data rows will be added here dynamically -->
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        var tenantId = localStorage.getItem('tenantId');
        var marquee = document.querySelector('marquee');
        var announcementModal = new bootstrap.Modal(document.getElementById('announcementModal'), {});
        var announcementDetailsTableBody = document.getElementById('announcementDetailsTableBody');

        function loadCommunications() {
            if (tenantId) {
                fetch('@Url.Action("ViewCommunicationsByTenantId", "Home")' + '?tenantId=' + encodeURIComponent(tenantId))
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to fetch data: ' + response.statusText);
                        }
                        return response.json();
                    })
                    .then(data => {
                        let tableRows = '';
                        const totalAnnouncements = data.length;
                        data.forEach(item => {
                            tableRows += `<tr>
                                    <td>${item.Subject || ''}</td>
                                    <td>${item.Message || ''}</td>
                                       <td>${totalAnnouncements}</td>
                                    <td>${item.RemoveFeedDate || ''}</td>
                                    <td>${item.AddedAt || ''}</td>
                                    <td>${item.AddedBy || ''}</td>
                                </tr>`;
                        });
                        announcementDetailsTableBody.innerHTML = tableRows;
                        if (data.length > 0) {
                            var messages = data.map(item => item.Message).join(' *** ');
                            marquee.textContent = `Announcements: ${data.length} : ${messages}`;
                        } else {
                            marquee.textContent = 'No communications found.';
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching communications:', error);
                        announcementDetailsTableBody.innerHTML = `<tr><td colspan="6">Failed to load communications.</td></tr>`;
                        marquee.textContent = 'Failed to load communications.';
                    });
            } else {
                announcementDetailsTableBody.innerHTML = `<tr><td colspan="6">No tenant ID found.</td></tr>`;
                marquee.textContent = 'No tenant ID found.';
            }
        }

        // Load communications immediately
        loadCommunications();

        // Optionally, reload communications when marquee is clicked
        marquee.addEventListener('click', function () {
            announcementModal.show();
        });
    });
</script>
